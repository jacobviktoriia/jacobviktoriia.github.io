<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Jacob & Viktoriia's Wedding Invitation" />
  <title>Jacob & Viktoriia</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Raleway:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" href="./assets/favicon.png">
  <link rel="icon" type="image/x-icon" href="./assets/favicon.ico">
  <link rel="apple-touch-icon" href="./assets/favicon.png">
</head>
<body>
  <header>
    <div class="header-content">
      <h1>Jacob & Viktoriia</h1>
      <div class="subtitle">We're getting married!</div>
      <!-- <div class="date">7·µó ∞ July 2025</div> -->
    </div>
  </header>

  <div class="container">
    <main>
      <section class="intro">
        <h2>Our Journey</h2>
        <p>Hello! It's <strong>Jacob</strong> and <strong>Viktoriia</strong>. Please press "Play Music" at the bottom right corner to enjoy the moment with us!</p>
        <p>We're so excited to share this special season of our lives with you. After months of planning, multiple adjustments, unexpected visa hurdles, and the everyday work/life obstacles, our wedding preparations have often felt nearly impossible. But with God, all things are possible through prayer and faith.</p>
        <p>First, we warmly invite you to join us <strong>virtually</strong> to witness the exchange of our wedding vows. Although visa issues have kept our families apart, this virtual gathering will allow both our families and friends to be present as we say "I do." Your presence (even from afar!) means everything to us. And don't worry, once visas are finalized, we‚Äôll celebrate <strong>in person</strong> together with even more joy!</p>
      </section>

      <div class="floral-divider">
        <span>‚ùÄ</span><span>‚ùÄ</span><span>‚ùÄ</span>
      </div>

      <section class="event">
        <h2>Online Courthouse Wedding Ceremony</h2>
        <div class="event-details">
          <div class="detail-card">
            <h4>Date</h4>
            <p><strong>7·µó ∞ July 2025</strong></p>
          </div>
          <div class="detail-card">
            <h4>Time</h4>
            <p><strong>6:30 PM (UTC-6)</strong></p>
          </div>
          <div class="detail-card">
            <h4>Location</h4>
            <p><strong>Link Below</strong></p>
          </div>
        </div>
        <!-- <a href="https://app.acuityscheduling.com/schedule.php?owner=17450053&action=zoom&uniqueID=c2a9782232336b54ac859e2b5b27f56c&ownerID=17450053" class="join-button" target="_blank">Join Our Ceremony</a> -->
        <!-- <p style="margin-top: 20px; text-align: center;">
          <a href="./timezones.html" target="_blank" style="color: var(--dark-purple); text-decoration: underline; font-weight: 500;">Time Zone Checker</a>
        </p> -->
        <!-- <p style="margin-top: 20px; text-align: center;">
          <a href="#" onclick="openTimezoneModal(); return false;" style="color: var(--dark-purple); text-decoration: underline; font-weight: 500; cursor: pointer;">Time Zone Checker</a>
        </p> -->
        <div class="ceremony-button-group">
          <a href="https://app.acuityscheduling.com/schedule.php?owner=17450053&action=zoom&uniqueID=c2a9782232336b54ac859e2b5b27f56c&ownerID=17450053" class="join-button" target="_blank">Join Our Ceremony</a>
          <button type="button" onclick="openTimezoneModal()" class="timezone-button">Time Zone Checker</button>
        </div>
        <p style="margin-top: 30px;">No RSVP required. The ceremony will be recorded for visa documentation (and of course, for our own cherished memories!). We‚Äôd love to see your faces with cameras on, but there‚Äôs absolutely no pressure.</p>
        <p>We kindly ask our guests to remain silent during the ceremony until Jacob & Viktoriia are officially pronounced husband and wife. Thank you so much! We can't wait to see you all soon! ‚ù§Ô∏è</p>
      </section>

      <div class="floral-divider">
        <span>‚ùÄ</span><span>‚ùÄ</span><span>‚ùÄ</span>
      </div>

      <section class="timeline">
        <h2>Our Timeline</h2>
        <div class="milestone">
          <div class="milestone-icon">1</div>
          <h3>Marriage Documents & Apostille Process</h3>
          <p><strong>Estimated:</strong> 4‚Äì6 weeks after the ceremony</p>
          <p>We'll be processing the official paperwork to make everything legally recognized.</p>
        </div>
        <div class="milestone">
          <div class="milestone-icon">2</div>
          <h3>Visa Documentation & Travel</h3>
          <p><strong>Timeline:</strong> Aug-Sep 2025</p>
          <p>We'll meet in person to celebrate being newlyweds after almost a year apart! During this visit, we'll also gather the marriage documentation required for our visa application.</p>
        </div>
        <div class="milestone">
          <div class="milestone-icon">3</div>
          <h3>Marriage Visa Application</h3>
          <p><strong>Estimated Processing Time:</strong> ~18 months</p>
          <p>While we wait for our visa applications to finish processing, we plan to stay in Georgia üá¨üá™ to see each other as often and as long as possible. We'll share a short, interesting story about how the Lord gave us a clear and faithful path to lead us here. We'd also love to continue updating you on where He leads us next in our lives.</p>
        </div>
        <div class="milestone">
          <div class="milestone-icon">4</div>
          <h3>In-Person Wedding Celebration</h3>
          <p><strong>When:</strong> Summer 2026</p>
          <p>We plan to celebrate our marriage with your presence in our home countries (United States üá∫üá∏ with Jacob's family & friends and Russia üá∑üá∫ with Viktoriia's family & friends). We will send a formal invitation as we approach that date, soon after Viktoriia's US marriage visa and Jacob's Russian marriage visa gets approved.</p>
          <p><em>Note: This will be a physical celebration with full wedding experience including menu, registry, and all traditional elements.</em></p>
        </div>
      </section>

      <div class="floral-divider">
        <span>‚ùÄ</span><span>‚ùÄ</span><span>‚ùÄ</span>
      </div>

      <section class="prayer">
        <h2>Our Prayer Request</h2>
        <p>We thank you for your prayers as we journey through what God has planned for us. Please pray for our marriage and visa processes.</p>
        <p>Thank you for your love and support, through God's mercy and grace, as we continue this beautiful journey together.</p>
      </section>

      <section class="bonus">
        <h2>Stay Connected</h2>
        <p>We'll keep this website open and updated with major life updates moving forward, such as visa progress, our day-to-day marriage life, and even future blessings like having children!</p>
        <p>Feel free to bookmark this address to follow our journey:</p>
        <p><strong><a href="https://jacobviktoriia.github.io" style="color: var(--dark-purple); text-decoration: underline; font-weight: 500;" target="_blank">https://jacobviktoriia.github.io</a></strong></p>
      </section>
    </main>
  </div>

  <footer>
    <p>With love and great joy,</p>
    <p><strong>Jacob & Viktoriia</strong></p>
    <!-- <div class="website-link">jacobviktoriia.github.io</div> -->
  </footer>

  <script src="script.js"></script>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, orderBy, query, serverTimestamp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

    // Replace this with YOUR actual Firebase config from Step 3
    const firebaseConfig = {
    apiKey: "AIzaSyDRa86_S_GMzJJ2icNxSnGDy_GkIMQzbdA",
    authDomain: "jacobvika.firebaseapp.com",
    projectId: "jacobvika",
    storageBucket: "jacobvika.firebasestorage.app",
    messagingSenderId: "842385732773",
    appId: "1:842385732773:web:b18de6f1b66affd90a894c",
    measurementId: "G-HLN1QBLWYM"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Check if user can delete a message (based on name matching)
    function canUserDelete(messageName) {
      const userMessages = JSON.parse(localStorage.getItem('userMessages') || '[]');
      return userMessages.includes(messageName.trim().toLowerCase());
    }

    // Delete message function
    window.deleteGuestbookMessage = async function(docId, messageName) {
      if (!canUserDelete(messageName)) {
        alert("You can only delete your own messages.");
        return false;
      }

      const confirmDelete = confirm("Are you sure you want to delete this message?");
      if (!confirmDelete) return false;

      try {
        await deleteDoc(doc(db, "guestbook", docId));
        
        // Remove from user's local storage
        const userMessages = JSON.parse(localStorage.getItem('userMessages') || '[]');
        const updatedMessages = userMessages.filter(name => name !== messageName.trim().toLowerCase());
        localStorage.setItem('userMessages', JSON.stringify(updatedMessages));
        
        // Reload messages to reflect the deletion
        await loadMessages();
        
        console.log('Message deleted successfully');
        return true;
      } catch (error) {
        console.error("Error deleting message: ", error);
        alert("Error deleting message. Please try again.");
        return false;
      }
    };

    // Load existing messages when page loads
    // Replace the loadMessages function in your Firebase script section

    // Load existing messages when page loads
    async function loadMessages() {
      try {
        const q = query(collection(db, "guestbook"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        const entriesContainer = document.querySelector('.guestbook-entries');
        
        // Clear existing entries first
        entriesContainer.innerHTML = '';
        
        querySnapshot.forEach((messageDoc) => {
          const data = messageDoc.data();
          const entry = document.createElement('div');
          entry.className = 'guestbook-entry';
          
          // Handle timestamp properly
          let dateString = 'Just now';
          if (data.timestamp && data.timestamp.toDate) {
            dateString = data.timestamp.toDate().toLocaleDateString();
          }

          // Check if user can delete this message
          const showDeleteButton = canUserDelete(data.name);
          
          // Convert line breaks to HTML line breaks for display
          const messageWithLineBreaks = escapeHtml(data.message).replace(/\n/g, '<br>');
          
          entry.innerHTML = `
            <div class="message-header">
              <h4>${escapeHtml(data.name)}${showDeleteButton ? `<button class="delete-button" onclick="deleteGuestbookMessage('${messageDoc.id}', '${escapeHtml(data.name)}')" title="Delete your message">üóëÔ∏è</button>` : ''}</h4>
            </div>
            <p class="message-content">${messageWithLineBreaks}</p>
            <small>${dateString}</small>
          `;
          entriesContainer.appendChild(entry);
        });
        
        // Update the comments count after loading messages
        if (typeof window.updateCommentsCount === 'function') {
          window.updateCommentsCount();
        }
        
        console.log('Messages loaded successfully');
      } catch (error) {
        console.error("Error loading messages: ", error);
      }
    }

    // Also update the submitGuestbookMessage function to refresh the count
    window.submitGuestbookMessage = async function(name, message) {
      try {
        await addDoc(collection(db, "guestbook"), {
          name: name,
          message: message,
          timestamp: serverTimestamp()
        });
        
        // Store the user's name in localStorage so they can delete their messages
        const userMessages = JSON.parse(localStorage.getItem('userMessages') || '[]');
        const normalizedName = name.trim().toLowerCase();
        if (!userMessages.includes(normalizedName)) {
          userMessages.push(normalizedName);
          localStorage.setItem('userMessages', JSON.stringify(userMessages));
        }
        
        // Reload messages to show the new one and update count
        await loadMessages();
        
        console.log('Message added successfully');
        return true;
      } catch (error) {
        console.error("Error adding message: ", error);
        return false;
      }
    };

    // Update the deleteGuestbookMessage function to refresh the count
    window.deleteGuestbookMessage = async function(docId, messageName) {
      if (!canUserDelete(messageName)) {
        alert("You can only delete your own messages.");
        return false;
      }

      const confirmDelete = confirm("Are you sure you want to delete this message?");
      if (!confirmDelete) return false;

      try {
        await deleteDoc(doc(db, "guestbook", docId));
        
        // Remove from user's local storage
        const userMessages = JSON.parse(localStorage.getItem('userMessages') || '[]');
        const updatedMessages = userMessages.filter(name => name !== messageName.trim().toLowerCase());
        localStorage.setItem('userMessages', JSON.stringify(updatedMessages));
        
        // Reload messages to reflect the deletion and update count
        await loadMessages();
        
        console.log('Message deleted successfully');
        return true;
      } catch (error) {
        console.error("Error deleting message: ", error);
        alert("Error deleting message. Please try again.");
        return false;
      }
    };

    // Add new message to Firestore
    window.submitGuestbookMessage = async function(name, message) {
      try {
        await addDoc(collection(db, "guestbook"), {
          name: name,
          message: message,
          timestamp: serverTimestamp()
        });
        
        // Store the user's name in localStorage so they can delete their messages
        const userMessages = JSON.parse(localStorage.getItem('userMessages') || '[]');
        const normalizedName = name.trim().toLowerCase();
        if (!userMessages.includes(normalizedName)) {
          userMessages.push(normalizedName);
          localStorage.setItem('userMessages', JSON.stringify(userMessages));
        }
        
        // Reload messages to show the new one
        await loadMessages();
        
        console.log('Message added successfully');
        return true;
      } catch (error) {
        console.error("Error adding message: ", error);
        return false;
      }
    };

    // Simple HTML escape function for security
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Load messages when the page loads
    document.addEventListener('DOMContentLoaded', function() {
      // Wait a bit for the guestbook section to be created by your existing script
      setTimeout(loadMessages, 1000);
    });
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Jacob & Viktoriia's Wedding Invitation" />
  <title>Jacob & Viktoriia | Wedding Invitation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Raleway:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <div class="header-content">
      <h1>Jacob & Viktoriia</h1>
      <div class="subtitle">We're getting married!</div>
      <!-- <div class="date">7·µó ∞ July 2025</div> -->
    </div>
  </header>

  <div class="container">
    <main>
      <section class="intro">
        <h2>Our Journey</h2>
        <p>Hey Everyone! It's Jacob and Viktoriia. Please press "Play Music" at the bottom right corner to enjoy the moment with us!</p>
        <p>We're excited to share this special season of our lives with you. Through countless plans, unexpected changes due to visa challenges, and the everyday ups and downs of life, our wedding preparations have often felt nearly impossible. But with God, all things are possible through prayer and faith.</p>
        <p>First, we warmly invite you to join us virtually to witness the exchange of our wedding vows. Although visa issues have kept our families apart, this virtual gathering will allow both our immediate families to be present as we say "I do." Afterward, we‚Äôll celebrate together. Afterward, we‚Äôll celebrate in person together once the visa process is complete.</p>
      </section>

      <div class="floral-divider">
        <span>‚ùÄ</span><span>‚ùÄ</span><span>‚ùÄ</span>
      </div>

      <section class="event">
        <h2>Online Courthouse Wedding Ceremony</h2>
        <div class="event-details">
          <div class="detail-card">
            <h4>Date</h4>
            <p><strong>7·µó ∞ July 2025</strong></p>
          </div>
          <div class="detail-card">
            <h4>Time</h4>
            <p><strong>6:00 PM (UTC-6)</strong></p>
          </div>
          <div class="detail-card">
            <h4>Location</h4>
            <p><strong>Linked Below</strong></p>
          </div>
        </div>
        <a href="#" class="join-button">Join Our Ceremony</a>
      </section>

      <div class="floral-divider">
        <span>‚ùÄ</span><span>‚ùÄ</span><span>‚ùÄ</span>
      </div>

      <section class="timeline">
        <h2>Our Timeline</h2>
        <div class="milestone">
          <div class="milestone-icon">1</div>
          <h3>Marriage Documents & Apostille Process</h3>
          <p><strong>Estimated:</strong> 4‚Äì6 weeks after the ceremony</p>
          <p>We'll be processing the official paperwork to make everything legally recognized.</p>
        </div>
        <div class="milestone">
          <div class="milestone-icon">2</div>
          <h3>Visa Documentation & Travel</h3>
          <p><strong>Timeline:</strong> Aug-Sep 2025</p>
          <p>We'll meet in person to gather proof of our marriage for visa purposes. We literally have not seen each other in a year!</p>
        </div>
        <div class="milestone">
          <div class="milestone-icon">3</div>
          <h3>Marriage Visa Application</h3>
          <p><strong>Estimated Processing Time:</strong> ~18 months</p>
          <p>During this time, we plan to live together in Georgia üá¨üá™, while we wait for our visa application to process. We'll share a short, interesting story on how God gave us a clear and faithful path to lead us here. We'd also love to keep you updated on where God leads us next in our lives.</p>
        </div>
        <div class="milestone">
          <div class="milestone-icon">4</div>
          <h3>In-Person Wedding Celebration</h3>
          <p><strong>When:</strong> Summer 2026</p>
          <p><strong>Where:</strong> United States üá∫üá∏ (with Jacob's family & friends) & Russia üá∑üá∫ (with Viktoriia's family & friends).</p>
          <p>We plan to celebrate our marriage with your presence in both our home countries. We will send a formal invitation as we approach that date, soon after Viktoriia's US marriage visa and Jacob's Russian marriage visa gets approved.</p>
          <p><em>Note: This will be a physical celebration with full wedding experience including menu, registry, and all traditional elements.</em></p>
        </div>
      </section>

      <div class="floral-divider">
        <span>‚ùÄ</span><span>‚ùÄ</span><span>‚ùÄ</span>
      </div>

      <section class="prayer">
        <h2>Our Prayer Request</h2>
        <p>We thank you for your prayers as we journey through this timeline that God has created for us. Please pray for us that this may come to pass quickly through God's mercy and grace.</p>
        <p>Thank you for your love and support as we continue this beautiful journey together.</p>
      </section>

      <section class="bonus">
        <h2>Stay Connected</h2>
        <p>We'll keep this website updated with major life updates moving forward - like visa progress, our life in Georgia, and even future blessings like having children!</p>
        <p>Bookmark this website to follow our journey: <strong>jacobviktoriia.github.io</strong></p>
      </section>
    </main>
  </div>

  <footer>
    <p>With love, Jacob & Viktoriia</p>
    <div class="website-link">jacobviktoriia.github.io</div>
  </footer>

  <script src="script.js"></script>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, orderBy, query, serverTimestamp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

    // Replace this with YOUR actual Firebase config from Step 3
    const firebaseConfig = {
    apiKey: "AIzaSyDRa86_S_GMzJJ2icNxSnGDy_GkIMQzbdA",
    authDomain: "jacobvika.firebaseapp.com",
    projectId: "jacobvika",
    storageBucket: "jacobvika.firebasestorage.app",
    messagingSenderId: "842385732773",
    appId: "1:842385732773:web:b18de6f1b66affd90a894c",
    measurementId: "G-HLN1QBLWYM"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Check if user can delete a message (based on name matching)
    function canUserDelete(messageName) {
      const userMessages = JSON.parse(localStorage.getItem('userMessages') || '[]');
      return userMessages.includes(messageName.trim().toLowerCase());
    }

    // Delete message function
    window.deleteGuestbookMessage = async function(docId, messageName) {
      if (!canUserDelete(messageName)) {
        alert("You can only delete your own messages.");
        return false;
      }

      const confirmDelete = confirm("Are you sure you want to delete this message?");
      if (!confirmDelete) return false;

      try {
        await deleteDoc(doc(db, "guestbook", docId));
        
        // Remove from user's local storage
        const userMessages = JSON.parse(localStorage.getItem('userMessages') || '[]');
        const updatedMessages = userMessages.filter(name => name !== messageName.trim().toLowerCase());
        localStorage.setItem('userMessages', JSON.stringify(updatedMessages));
        
        // Reload messages to reflect the deletion
        await loadMessages();
        
        console.log('Message deleted successfully');
        return true;
      } catch (error) {
        console.error("Error deleting message: ", error);
        alert("Error deleting message. Please try again.");
        return false;
      }
    };

    // Load existing messages when page loads
    async function loadMessages() {
      try {
        const q = query(collection(db, "guestbook"), orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);
        const entriesContainer = document.querySelector('.guestbook-entries');
        
        // Clear existing entries first
        entriesContainer.innerHTML = '';
        
        querySnapshot.forEach((messageDoc) => {
          const data = messageDoc.data();
          const entry = document.createElement('div');
          entry.className = 'guestbook-entry';
          
          // Handle timestamp properly
          let dateString = 'Just now';
          if (data.timestamp && data.timestamp.toDate) {
            dateString = data.timestamp.toDate().toLocaleDateString();
          }

          // Check if user can delete this message
          const showDeleteButton = canUserDelete(data.name);
          
          // Convert line breaks to HTML line breaks for display
          const messageWithLineBreaks = escapeHtml(data.message).replace(/\n/g, '<br>');
          
          entry.innerHTML = `
            <div class="message-header">
              <h4>${escapeHtml(data.name)}${showDeleteButton ? `<button class="delete-button" onclick="deleteGuestbookMessage('${messageDoc.id}', '${escapeHtml(data.name)}')" title="Delete your message">üóëÔ∏è</button>` : ''}</h4>
            </div>
            <p class="message-content">${messageWithLineBreaks}</p>
            <small>${dateString}</small>
          `;
          entriesContainer.appendChild(entry);
        });
        
        console.log('Messages loaded successfully');
      } catch (error) {
        console.error("Error loading messages: ", error);
      }
    }

    // Add new message to Firestore
    window.submitGuestbookMessage = async function(name, message) {
      try {
        await addDoc(collection(db, "guestbook"), {
          name: name,
          message: message,
          timestamp: serverTimestamp()
        });
        
        // Store the user's name in localStorage so they can delete their messages
        const userMessages = JSON.parse(localStorage.getItem('userMessages') || '[]');
        const normalizedName = name.trim().toLowerCase();
        if (!userMessages.includes(normalizedName)) {
          userMessages.push(normalizedName);
          localStorage.setItem('userMessages', JSON.stringify(userMessages));
        }
        
        // Reload messages to show the new one
        await loadMessages();
        
        console.log('Message added successfully');
        return true;
      } catch (error) {
        console.error("Error adding message: ", error);
        return false;
      }
    };

    // Simple HTML escape function for security
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Load messages when the page loads
    document.addEventListener('DOMContentLoaded', function() {
      // Wait a bit for the guestbook section to be created by your existing script
      setTimeout(loadMessages, 1000);
    });
  </script>
</body>
</html>